<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Market Risk Monitor</title>
</head>
<body>

<h1>Market Risk Monitor</h1>

<section id="banner">
  <h2 id="state">Loading…</h2>
  <p id="summary"></p>
</section>

<section id="history">
  <strong>Recent history (last 12 weeks):</strong>
  <div id="timeline" aria-label="Market risk state history"></div>
  <div id="legend">
    ▢ Nominal &nbsp; ▲ Downturn &nbsp; ▼ Recovery
  </div>
</section>

<hr>

<section id="disclaimer">
  <strong>Disclaimer:</strong>
  This site is for informational purposes only and does not constitute investment advice.
</section>

<section id="contact">
  <strong>Contact:</strong>
  <a href="mailto:you@example.com">you@example.com</a>
</section>

<script>
/* ---------- Banner ---------- */
fetch('./data/state_snapshot.json')
  .then(r => r.json())
  .then(d => {
    const severityText = d.severity ? ` (Severity ${d.severity})` : '';
    document.getElementById('state').textContent =
      `MARKET RISK STATE: ${d.state}${severityText}`;
    document.getElementById('summary').textContent = d.summary;
  })
  .catch(() => {
    document.getElementById('state').textContent = 'State unavailable';
  });

/* ---------- Timeline ---------- */
fetch('./data/state_history.csv')
  .then(r => r.text())
  .then(text => {
    const lines = text.trim().split('\n');
    if (lines.length <= 1) return;

    const symbols = {
      NOMINAL: '▢',
      DOWNTURN: '▲',
      RECOVERY: '▼'
    };

    const rows = lines.slice(1).map(l => l.split(','));
    const recent = rows.slice(-12);

    const timeline = recent
      .map(r => symbols[r[1]] || '?')
      .join(' ');

    document.getElementById('timeline').textContent = timeline;
  });
</script>

</body>
</html>