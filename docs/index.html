<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Market Risk Monitor</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css" />
</head>
<body>

<body>
  <section class="section">
    <div class="container">

      <h1 class="title">Market Risk Monitor</h1>

      <div id="banner" class="notification">
        <h2 id="state" class="subtitle">Loading…</h2>
        <p id="summary"></p>
      </div>

      <div class="box">
        <p class="has-text-weight-semibold">Recent history (last 12 weeks)</p>
        <pre id="timeline"></pre>
        <p class="is-size-7">
          ▢ Nominal &nbsp;&nbsp; ▲ Downturn &nbsp;&nbsp; ▼ Recovery
        </p>
      </div>

      <div class="box">
        <p class="has-text-weight-semibold">Quarterly summary</p>
        <p id="quarterly-text"></p>
      </div>

      <hr>

      <div class="content is-size-7">
        <p>
          <strong>Disclaimer:</strong>
          This project is for informational purposes only. It does not constitute
          investment advice or a recommendation to buy or sell any security.
          The system is intentionally conservative and slow‑moving, and is designed
          to support disciplined long‑term decision‑making rather than short‑term
          market timing.
        </p>

        <p>
          <strong>Contact:</strong>
          <a href="mailto:you@example.com">you@example.com</a>
        </p>
      </div>

    </div>
  </section>

<script>
/* ---------- Banner ---------- */
fetch('./data/state_snapshot.json')
  .then(r => r.json())
  .then(d => {
    const stateEl = document.getElementById('state');
    const summaryEl = document.getElementById('summary');

    if (d.override) {
      stateEl.textContent = `MARKET RISK STATE: ${d.state} (MANUAL OVERRIDE)`;
      summaryEl.textContent = d.summary;
    } else {
      const severityText = d.severity ? ` (Severity ${d.severity})` : '';
      stateEl.textContent =
        `MARKET RISK STATE: ${d.state}${severityText}`;
      summaryEl.textContent = d.summary;
    }
  })
  .catch(() => {
    document.getElementById('state').textContent = 'State unavailable';
  });

/* ---------- Timeline ---------- */
fetch('./data/state_history.csv')
  .then(r => r.text())
  .then(text => {
    const lines = text.trim().split('\n');
    if (lines.length <= 1) return;

    const symbols = {
      NOMINAL: '▢',
      DOWNTURN: '▲',
      RECOVERY: '▼'
    };

    const rows = lines.slice(1).map(l => l.split(','));
    const recent = rows.slice(-12);

    const timeline = recent
      .map(r => symbols[r[1]] || '?')
      .join(' ');

    document.getElementById('timeline').textContent = timeline;
  });
</script>

<script>
/* ---------- Quarterly Narrative ---------- */
fetch('./data/quarterly_narrative.json')
  .then(r => r.json())
  .then(data => {
    const periods = Object.keys(data).sort();
    if (periods.length === 0) return;

    const latest = periods[periods.length - 1];
    document.getElementById('quarterly-text').textContent =
      data[latest].text;
  })
  .catch(() => {
    document.getElementById('quarterly-text').textContent =
      'Quarterly summary unavailable.';
  });
</script>

</body>
</html>